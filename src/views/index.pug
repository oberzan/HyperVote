extends layout

block head
  script(defer type='text/javascript', src='/javascripts/index.js')
  script(defer type='text/javascript', src='https://www.gstatic.com/charts/loader.js')

block content
  div.container(style="max-width: 800px")
    h1= title
    br
    div#ballots
      each ballot, i in ballots
        div.card(class=i)
          div.card-header(id="heading"+i)
            h5.mb-0
              btn.btn.btn-link(data-toggle="collapse" data-target="#collapse"+i aria-expanded="false" aria-controls="collapse"+i)
                =ballot.title
          div.collapse(id="collapse"+i aria-labelledby="heading"+i data-parent="#ballots")
            div.card-body
              p 
                =ballot.description
              if moment(ballot.end) >= moment()
                form(action=`api/vote/${ballot.title}`, method="post")
                  div.form-group
                    label(for=i) #{i18n.__("Choose an option")}:
                    each option in ballot.options
                      div.form-check
                        input.form-check-input(type="radio" name="option" value=option.Name)
                        label.form-check-label 
                          =option.Name
                  div.form-group
                    label(for="token"+i) #{i18n.__("Insert token")}
                    input.form-control.token(id="token"+i name="token")
                    div.valid-feedback #{i18n.__("Vote successfull")}
                    div.invalid-feedback #{i18n.__("Vote unsuccessfull")}
                  button.btn.btn-primary(type="submit" disabled=true) #{i18n.__("Vote")}
              else
                - let options = ballotsOptions[ballot.title].options
                - let nVotes = ballotsOptions[ballot.title].nVotes
                div.row
                  div.col-7.chart(style="padding:0; min-height:200px")
                  div.col-md-5
                    table.table.table-sm.table-hover
                      thead.thead-light
                        tr.d-flex
                          th.col-1
                          th.col-7(scope="col") #{i18n.__("Option")}
                          th.col-2(scope="col") #
                          th.col-2(scope="col") %
                      tbody
                        each option,j in ballotsOptions[ballot.title].options
                          tr.d-flex
                            td.col-1
                              div.circle(style="background:" + googleColors[j])
                            td.col-7.option #{option.name == "undefined" ? i18n.__("undefined vote") : option.name}
                            td.col-2.n #{option.n}
                            td.col-2 #{100 * option.n / ballotsOptions[ballot.title].nVotes}
                      tfoot
                        tr.d-flex
                          td.col-1
                          td.col-7
                          th.col-2 #{ballotsOptions[ballot.title].nVotes}
                          td.col-2